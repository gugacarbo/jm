<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
  <br>
  <h3>Get Payment Code</h3>
  <div style="display: flex; width: 500px;">
    <input type="text" id="link" style="display: flex; width: 500px;">
    <button id="getLink">GetLink</button>
    <button id="go">Go</button>
  </div>
  <br><br><br>
  <h3>Get Payment Status by notificationCode</h3>
  <div style="display: flex;">

    <input type="text" id="notificationCode" style="display: flex; width: 300px;">
    <button id="getStatus">Get Status</button>

  </div>
  <table id="list">

  </table>


  <script type="text/javascript"
    src="https://stc.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.lightbox.js"></script>

  <script type="text/javascript">

    

    $(document).ready(() => {

      $("#getStatus").on('click', () => {
        $.get("readNorificationCode.php", { 'notificationCode': $("#notificationCode").val() }, (data) => {
          var resp = JSON.parse(data)
          $("#list").empty();;
          console.log(resp);


          $.each(resp, function (i, item) {
            console.log(i + " " + (typeof (item) == "object" ? "{" : item));
            $("#list").append("<tr><td>" + i + "</td><td>" + (typeof (item) == "object" ? "{" : item) + "</td></tr>")

            if (typeof (item) == "object") {
              $.each(item, function (j, t) {
                console.log('"' + j + " : " + t + '"');
                $("#list").append("<tr><td>" + j + "</td><td>" + (typeof (t) == "object" ? "{" : t) + "</td></tr>")

                if (typeof (t) == "object") {
                  $.each(t, function (l, k) {
                    console.log('"' + l + " : " + k + '"');
                    $("#list").append("<tr><td>" + l + "</td><td>" + k + "</td></tr>")

                  })
                }

              })
              console.log("}")
              $("#list").append("<tr><td>}</td><td></td></tr>")

            }
          });

        })
      })


      $("#go").on('click', () => {
        if ($("#link").val() != "") {
          window.open($("#link").val(), '_blank').focus();
          //lightbox($("#link").val()); 
        }
      })

      $("#getLink").on('click', () => {
        $.get("generateLink.php", (data) => {
          $("#link").val(data);
        })
      })
    })
  </script>
</body>

</html>


<!--/*
function lightbox(code) {
      var callback = {
        success: function (transactionCode) {
          //Insira os comandos para quando o usuário finalizar o pagamento. 
          //O código da transação estará na variável "transactionCode"
          console.log("Compra feita com sucesso, código de transação: " + transactionCode);
        },
        abort: function () {
          //Insira os comandos para quando o usuário abandonar a tela de pagamento.
          console.log("abortado");
        }
      };
      //Chamada do lightbox passando o código de checkout e os comandos para o callback
      var isOpenLightbox = PagSeguroLightbox(code, callback);
      // Redireciona o comprador, caso o navegador não tenha suporte ao Lightbox
      if (!isOpenLightbox) {
        location.href = "https://pagseguro.uol.com.br/v2/checkout/payment.html?code=" + code;
        console.log("Redirecionamento")
      }
    }
*/