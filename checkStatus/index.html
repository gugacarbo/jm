<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Jm Acessórios de Luxo</title>

    <link rel="stylesheet" href="/css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/dd47628d23.js" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js"></script>


</head>

<body>
    <script src="/jquery.mask.js"></script>

    <header>

    </header>

    <div class="checkStatusPage">
        <span>Status de Compra</span>
        <input type="text" placeholder="CPF" name="cpf" id="ConsultaCPF">
        <input type="text" placeholder="Código do pedido" name="idPedido" id="ConsultaIdPedido">
        <button id="acessarPedido">Acessar</button>
        <p id="error">Acesse o status do seu pedido</p>
    </div>
    <footer>

    </footer>

    <script>

        $(document).ready(() => {
            $("header").load("/includes/header.html");
            $("footer").load("/includes/footer.html");
            $('#ConsultaCPF').mask('000.000.000-00');
            //$('#ConsultaIdPedido').mask('00000000-0000-0000-0000-000000000000');

            $("#acessarPedido").on("click", () => {
                if ($("#ConsultaCPF").val().length < 14 || $("#ConsultaIdPedido").val().length < 36) {

                    if ($("#ConsultaIdPedido").val().length < 36)
                        $("#error").html("Código Inválido");
                    if ($("#ConsultaCPF").val().length < 14)
                        $("#error").html("CPF Inválido");
                
                    } else {
                    var cpf = $("#ConsultaCPF").val().replace(".", "").replace(".", "").replace("-", "");
                    var code = $("#ConsultaIdPedido").val();
                    var data = {
                        "cpf": cpf,
                        "code": code
                    }
                    console.log(data)
                    $.get("/php/verifyCode.php", data, (code) => {
                        code = JSON.parse(code);
                        console.log(code);
                        if (code["status"] == "error") {
                            $("#error").html(code["message"])
                        } else if (code["code"]) {
                            window.location.replace("/status/?code=" + code["code"] + "&cpf=" + code["cpf"]);
                        }
                    })
                }
            })
            if($.urlParam("code")){
                $("#ConsultaIdPedido").val($.urlParam("code"));
            }
        })

        $.urlParam = function (name) {
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results == null) {
                return null;
            }
            else {
                return results[1] || 0;
            }
        }
        
        
    </script>

</body>

</html>